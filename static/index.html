<html>
  <head>
    <title>Reverse image lookup API</title>
      <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-7s5uDGW3AHqw6xtJmNNtr+OBRJUlgkNJEo78P4b0yRw= sha512-nNo+yCHEyn0smMxSswnf/OnX6/KwJuZTlNZBjauKhTK0c+zT+q5JOCx0UFhXQ6rJR9jg6Es8gPuD2uZcYDLqSw==" crossorigin="anonymous">
  </head>
  <body>
      <div class="container">
      <form id="uploadForm"
          enctype="multipart/form-data"
          action="https://temp.justinoboyle.com/upload"
          method="post">
      <input type="file" name="image" /> <br />
      <input type="submit" value="Upload Image" name="submit">
      <span id = "status"></span>
    </form>
          </div>
  </body>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>
  <script>
  PFX_URL = "/proxy/?url=https://images.google.com/searchbyimage?image_url=";
  IMG_LINK_PFX = "https://temp.justinoboyle.com/download/";

  function httpGetAsync(theUrl, callback)
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function() {
            if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                callback(xmlHttp.responseText);
        }
        xmlHttp.open("GET", theUrl, true); // true for asynchronous
        xmlHttp.send(null);
    }

  $(document).ready(function() {

     $('#uploadForm').submit(function() {
		 $("#status").empty().text("File is uploading...");

        $(this).ajaxSubmit({

            error: function(xhr) {
		            status('Error: ' + xhr.status);
            },

            success: function(response) {
              $("#status").empty().text("Reading image...");
    					var res = JSON.parse(response);
              var tempURL = PFX_URL + encodeURIComponent(IMG_LINK_PFX + res.name);
              console.log(tempURL);
              httpGetAsync(tempURL, function(data) {
                console.log(data);
                var el = document.createElement( 'html' );
                el.innerHTML = data;
                var obj = el.getElementsByClassName("_gUb")[0].innerHTML;
                $("#status").empty().text(obj);
              })
            }
	});

	return false;
    });
});
  </script>
</html>
